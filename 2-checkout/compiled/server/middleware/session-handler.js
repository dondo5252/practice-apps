"use strict";

var _require = require("uuid"),
    uuidv4 = _require.v4;

module.exports = function (req, res, next) {
  /**
   *
   * Parse cookies in incoming request:
   *
   */
  var cookieString = req.get("Cookie") || "";
  parsedCookies = cookieString.split("; ").reduce(function (cookies, cookie) {
    if (cookie.length) {
      var index = cookie.indexOf("=");
      var key = cookie.slice(0, index);
      var token = cookie.slice(index + 1);
      cookies[key] = token;
    }

    return cookies;
  }, {});

  if (parsedCookies.s_id) {
    req.session_id = parsedCookies.s_id;
  } else {
    req.session_id = uuidv4();
    res.cookie("s_id", req.session_id);
  }

  next();
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1aXJlIiwidXVpZHY0IiwidjQiLCJtb2R1bGUiLCJleHBvcnRzIiwicmVxIiwicmVzIiwibmV4dCIsImNvb2tpZVN0cmluZyIsImdldCIsInBhcnNlZENvb2tpZXMiLCJzcGxpdCIsInJlZHVjZSIsImNvb2tpZXMiLCJjb29raWUiLCJsZW5ndGgiLCJpbmRleCIsImluZGV4T2YiLCJrZXkiLCJzbGljZSIsInRva2VuIiwic19pZCIsInNlc3Npb25faWQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zZXJ2ZXIvbWlkZGxld2FyZS9zZXNzaW9uLWhhbmRsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2NDogdXVpZHY0IH0gPSByZXF1aXJlKFwidXVpZFwiKTtcblxubW9kdWxlLmV4cG9ydHMgPSAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgLyoqXG4gICAqXG4gICAqIFBhcnNlIGNvb2tpZXMgaW4gaW5jb21pbmcgcmVxdWVzdDpcbiAgICpcbiAgICovXG5cbiAgbGV0IGNvb2tpZVN0cmluZyA9IHJlcS5nZXQoXCJDb29raWVcIikgfHwgXCJcIjtcblxuICBwYXJzZWRDb29raWVzID0gY29va2llU3RyaW5nLnNwbGl0KFwiOyBcIikucmVkdWNlKChjb29raWVzLCBjb29raWUpID0+IHtcbiAgICBpZiAoY29va2llLmxlbmd0aCkge1xuICAgICAgbGV0IGluZGV4ID0gY29va2llLmluZGV4T2YoXCI9XCIpO1xuICAgICAgbGV0IGtleSA9IGNvb2tpZS5zbGljZSgwLCBpbmRleCk7XG4gICAgICBsZXQgdG9rZW4gPSBjb29raWUuc2xpY2UoaW5kZXggKyAxKTtcbiAgICAgIGNvb2tpZXNba2V5XSA9IHRva2VuO1xuICAgIH1cbiAgICByZXR1cm4gY29va2llcztcbiAgfSwge30pO1xuXG4gIGlmIChwYXJzZWRDb29raWVzLnNfaWQpIHtcbiAgICByZXEuc2Vzc2lvbl9pZCA9IHBhcnNlZENvb2tpZXMuc19pZDtcbiAgfSBlbHNlIHtcbiAgICByZXEuc2Vzc2lvbl9pZCA9IHV1aWR2NCgpO1xuICAgIHJlcy5jb29raWUoXCJzX2lkXCIsIHJlcS5zZXNzaW9uX2lkKTtcbiAgfVxuXG4gIG5leHQoKTtcbn07XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsZUFBdUJBLE9BQU8sQ0FBQyxNQUFELENBQTlCO0FBQUEsSUFBWUMsTUFBWixZQUFRQyxFQUFSOztBQUVBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsVUFBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsRUFBb0I7RUFDbkM7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUVFLElBQUlDLFlBQVksR0FBR0gsR0FBRyxDQUFDSSxHQUFKLENBQVEsUUFBUixLQUFxQixFQUF4QztFQUVBQyxhQUFhLEdBQUdGLFlBQVksQ0FBQ0csS0FBYixDQUFtQixJQUFuQixFQUF5QkMsTUFBekIsQ0FBZ0MsVUFBQ0MsT0FBRCxFQUFVQyxNQUFWLEVBQXFCO0lBQ25FLElBQUlBLE1BQU0sQ0FBQ0MsTUFBWCxFQUFtQjtNQUNqQixJQUFJQyxLQUFLLEdBQUdGLE1BQU0sQ0FBQ0csT0FBUCxDQUFlLEdBQWYsQ0FBWjtNQUNBLElBQUlDLEdBQUcsR0FBR0osTUFBTSxDQUFDSyxLQUFQLENBQWEsQ0FBYixFQUFnQkgsS0FBaEIsQ0FBVjtNQUNBLElBQUlJLEtBQUssR0FBR04sTUFBTSxDQUFDSyxLQUFQLENBQWFILEtBQUssR0FBRyxDQUFyQixDQUFaO01BQ0FILE9BQU8sQ0FBQ0ssR0FBRCxDQUFQLEdBQWVFLEtBQWY7SUFDRDs7SUFDRCxPQUFPUCxPQUFQO0VBQ0QsQ0FSZSxFQVFiLEVBUmEsQ0FBaEI7O0VBVUEsSUFBSUgsYUFBYSxDQUFDVyxJQUFsQixFQUF3QjtJQUN0QmhCLEdBQUcsQ0FBQ2lCLFVBQUosR0FBaUJaLGFBQWEsQ0FBQ1csSUFBL0I7RUFDRCxDQUZELE1BRU87SUFDTGhCLEdBQUcsQ0FBQ2lCLFVBQUosR0FBaUJyQixNQUFNLEVBQXZCO0lBQ0FLLEdBQUcsQ0FBQ1EsTUFBSixDQUFXLE1BQVgsRUFBbUJULEdBQUcsQ0FBQ2lCLFVBQXZCO0VBQ0Q7O0VBRURmLElBQUk7QUFDTCxDQTNCRCJ9